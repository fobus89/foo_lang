# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù: –ë–∞–≥ —Å –∏–∑–æ–ª—è—Ü–∏–µ–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ —Ü–∏–∫–ª–∞—Ö

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –æ–±—ä—è–≤–ª–µ–Ω–Ω—ã–µ —Å `let` –≤–Ω—É—Ç—Ä–∏ —Ü–∏–∫–ª–æ–≤ `for`, –Ω–µ –±—ã–ª–∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –∏—Ç–µ—Ä–∞—Ü–∏—è–º. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –æ—à–∏–±–∫–µ "variable X is already defined" –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ–±—ä—è–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Å —Ç–µ–º –∂–µ –∏–º–µ–Ω–µ–º –≤ —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏.

### –ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º—ã:
```foo
for let i = 0; i < 2; i++ {
    let temp = i * 10  // –ü–µ—Ä–≤–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è: OK
    println(temp)      // –í—Ç–æ—Ä–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è: ERROR - "variable temp is already defined"
}
```

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### 1. –ü–æ–∏—Å–∫ –ø—Ä–æ–±–ª–µ–º—ã
- –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç `test_scope_bug4.foo` –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –±–∞–≥–∞
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∏—Ç–µ—Ä–∞—Ü–∏–π –æ—Å—Ç–∞—é—Ç—Å—è –≤–∏–¥–∏–º—ã–º–∏

### 2. –ê–Ω–∞–ª–∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–±–ª–µ–º—ã
- –í `ast/for_expr.go`: —Ü–∏–∫–ª —Å–æ–∑–¥–∞–≤–∞–ª –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º
- –ö–∞–∂–¥–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å –≤ —Ç–æ–π –∂–µ –æ–±–ª–∞—Å—Ç–∏, –±–µ–∑ –∏–∑–æ–ª—è—Ü–∏–∏

### –ö–æ–¥ –¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```go
func (f *ForExpr) Eval() *Value {
    // –°–æ–∑–¥–∞—ë–º –ª–æ–∫–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏ –¥–ª—è —Ü–∏–∫–ª–∞ (–û–î–ò–ù –†–ê–ó)
    scope.GlobalScope.Push()
    defer scope.GlobalScope.Pop()

    f.InitExpr.Eval()
    for {
        if !f.ConditionExpr.Eval().Bool() { break }
        
        // –í—Å–µ –∏—Ç–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –û–î–ù–û–ô –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏
        for _, statment := range statments {
            statment.Eval() // let temp —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ —Ç–æ–π –∂–µ –æ–±–ª–∞—Å—Ç–∏
        }
        
        f.StepExpr.Eval()
    }
}
```

## üîß –†–µ—à–µ–Ω–∏–µ

### 1. –ò–∑–æ–ª—è—Ü–∏—è –ø–æ –∏—Ç–µ—Ä–∞—Ü–∏—è–º
–ò–∑–º–µ–Ω–∏–ª–∏ –ª–æ–≥–∏–∫—É —Ç–∞–∫, —á—Ç–æ–±—ã **–∫–∞–∂–¥–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è** —Ü–∏–∫–ª–∞ –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å –≤ —Å–≤–æ–µ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏.

### –ö–æ–¥ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```go
func (f *ForExpr) Eval() *Value {
    // –°–æ–∑–¥–∞—ë–º –ª–æ–∫–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏ –¥–ª—è —Ü–∏–∫–ª–∞
    scope.GlobalScope.Push()
    defer scope.GlobalScope.Pop()

    f.InitExpr.Eval()
    for {
        if !f.ConditionExpr.Eval().Bool() { break }
        
        // üî• –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏
        scope.GlobalScope.Push()
        
        iterationBreak := false
        for _, statment := range statments {
            // –í—ã–ø–æ–ª–Ω—è–µ–º statement –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –∏—Ç–µ—Ä–∞—Ü–∏–∏
            // ...
        }
        
        // –û—á–∏—â–∞–µ–º –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∏—Ç–µ—Ä–∞—Ü–∏–∏
        scope.GlobalScope.Pop()
        
        if iterationBreak { break }
        f.StepExpr.Eval()
    }
}
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ break
–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å `break` –≤ for-yield —Ü–∏–∫–ª–∞—Ö:

**–ü—Ä–æ–±–ª–µ–º–∞**: `yield` –≤—ã–ø–æ–ª–Ω—è–ª—Å—è –ø–æ—Å–ª–µ `break`
```foo
for let i = 0; i < 10; i++ {
    if i > 4 { break }  // break –Ω–∞ i=5
    yield i             // –Ω–æ yield 5 –≤—Å–µ —Ä–∞–≤–Ω–æ –≤—ã–ø–æ–ª–Ω—è–ª—Å—è!
}
// –†–µ–∑—É–ª—å—Ç–∞—Ç: [0,1,2,3,4,5] –≤–º–µ—Å—Ç–æ [0,1,2,3,4]
```

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `iterationBreak` –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º `yield`
```go
case *YieldExpr:
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å–ª–∏ —É–∂–µ –±—ã–ª break, –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ–º yield
    if !iterationBreak {
        yield = append(yield, stm.Eval().Any())
    }
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –¢–µ—Å—Ç—ã –∏–∑–æ–ª—è—Ü–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
```foo
// –¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!
for let i = 0; i < 3; i++ {
    let temp = i * 10  // –ö–∞–∂–¥–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è –≤ —Å–≤–æ–µ–π –æ–±–ª–∞—Å—Ç–∏
    println("temp = " + temp)
}
// –í—ã–≤–æ–¥: temp = 0, temp = 10, temp = 20
```

### 2. –¢–µ—Å—Ç—ã break –≤ for-yield
```foo
const arr = for let i = 0; i < 10; i++ {
    if i > 4 { break }  // break —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
    yield i
}
// –†–µ–∑—É–ª—å—Ç–∞—Ç: [0,1,2,3,4] ‚úÖ
```

### 3. –í–ª–æ–∂–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã
```foo
for let outer = 1; outer <= 2; outer++ {
    for let inner = 1; inner <= 2; inner++ {
        let nested = outer * 100 + inner  // –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏
        println("nested = " + nested)
    }
}
// –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
‚ùå `variable temp is already defined` –Ω–∞ –≤—Ç–æ—Ä–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏  
‚ùå Break –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª yield –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ  
‚ùå –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∏—Ç–µ—Ä–∞—Ü–∏–π –æ—Å—Ç–∞–≤–∞–ª–∏—Å—å –≤–∏–¥–∏–º—ã–º–∏

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –∏—Ç–µ—Ä–∞—Ü–∏—è–º  
‚úÖ Break –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ yield  
‚úÖ –ö–∞–∂–¥–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è –∏–º–µ–µ—Ç —á–∏—Å—Ç—É—é –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏  
‚úÖ –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

## üèÜ –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å

**foo_lang** —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –∏–∑–æ–ª—è—Ü–∏—é –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ —Ü–∏–∫–ª–∞—Ö, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º —è–∑—ã–∫–æ–≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è.

### –û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:
- ‚úÖ **–ò—Ç–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è**: –∫–∞–∂–¥–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è —Ü–∏–∫–ª–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Å–≤–æ–µ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏
- ‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π break**: break –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ statements
- ‚úÖ **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ **–°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ**: —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç JavaScript, Python, Rust –∏ –¥—Ä—É–≥–∏–º —è–∑—ã–∫–∞–º

### –ü—Ä–∏–º–µ—Ä—ã —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è:

#### JavaScript:
```js
for (let i = 0; i < 2; i++) {
    let temp = i; // –ö–∞–∂–¥–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è –≤ —Å–≤–æ–µ–π –æ–±–ª–∞—Å—Ç–∏
}
```

#### Python:
```python
for i in range(2):
    temp = i  # Python –Ω–µ –∏–º–µ–µ—Ç –±–ª–æ—á–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏, –Ω–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è
```

#### Rust:
```rust
for i in 0..2 {
    let temp = i; // –ö–∞–∂–¥–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è –≤ —Å–≤–æ–µ–π –æ–±–ª–∞—Å—Ç–∏
}
```

#### foo_lang (—Ç–µ–ø–µ—Ä—å):
```foo
for let i = 0; i < 2; i++ {
    let temp = i  // ‚úÖ –ö–∞–∂–¥–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è –≤ —Å–≤–æ–µ–π –æ–±–ª–∞—Å—Ç–∏ - –∫–∞–∫ –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —è–∑—ã–∫–∞—Ö!
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: foo_lang —Ç–µ–ø–µ—Ä—å –≤–µ–¥–µ—Ç —Å–µ–±—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–Ω–∏—è–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤! üöÄ