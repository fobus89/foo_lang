// examples/jit_demo.foo - –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã JIT –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞

println("=== üî• –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø JIT –ö–û–ú–ü–ò–õ–Ø–¢–û–†–ê ===")
println()

// –§—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è —Å—Ç–∞–Ω–µ—Ç "–≥–æ—Ä—è—á–µ–π" 
fn hotFunction(x, y) {
    return x * x + y * y + 42
}

// –§—É–Ω–∫—Ü–∏—è —Å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ (—Ö–æ—Ä–æ—à–∏–π –∫–∞–Ω–¥–∏–¥–∞—Ç –¥–ª—è JIT)
fn mathIntensive(n) {
    let result = 0
    for let i = 0; i < n; i++ {
        result = result + abs(i - n/2) * 2
    }
    return result
}

println("üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –º–Ω–æ–≥–æ —Ä–∞–∑ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ JIT...")

// –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –º–Ω–æ–≥–æ —Ä–∞–∑ (150 > 100 threshold)
for let i = 0; i < 150; i++ {
    let result = hotFunction(i, i + 1)
    if i % 50 == 0 {
        println("–í—ã–∑–æ–≤ " + i.toString() + ": —Ä–µ–∑—É–ª—å—Ç–∞—Ç = " + result.toString())
    }
}

println()
println("‚úÖ –ü–æ—Å–ª–µ 150 –≤—ã–∑–æ–≤–æ–≤ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–∞ JIT!")

// –í—ã–∑—ã–≤–∞–µ–º –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
for let i = 0; i < 120; i++ {
    let result = mathIntensive(10)
    if i % 40 == 0 {
        println("MathIntensive –≤—ã–∑–æ–≤ " + i.toString() + ": —Ä–µ–∑—É–ª—å—Ç–∞—Ç = " + result.toString())
    }
}

println()
println("=== üìä JIT –°–¢–ê–¢–ò–°–¢–ò–ö–ê ===")
println("üî• –ì–æ—Ä—è—á–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å:")
println("  ‚Ä¢ hotFunction (150 –≤—ã–∑–æ–≤–æ–≤ > 100)")  
println("  ‚Ä¢ mathIntensive (120 –≤—ã–∑–æ–≤–æ–≤ > 100)")
println()
println("‚ö° JIT –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã:")
println("  ‚Ä¢ –ö–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–∞—è —Å–≤–µ—Ä—Ç–∫–∞ (constant folding)")
println("  ‚Ä¢ –ò–Ω–ª–∞–π–Ω –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π")
println("  ‚Ä¢ –ü—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã —Ñ—É–Ω–∫—Ü–∏–π")
println()
println("üìà –û–∂–∏–¥–∞–µ—Ç—Å—è —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏!")