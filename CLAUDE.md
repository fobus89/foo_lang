# Foo Language v2 - Информация для Claude

## Описание проекта
Интерпретируемый язык программирования **foo_lang** с динамической типизацией, написанный на Go. Это полнофункциональный современный язык программирования с поддержкой замыканий, анонимных функций, модульной системы, математических функций и многого другого.

## Структура проекта
```
D:\dev\go\foo_lang_v2\
├── ast/                    # AST узлы и интерпретатор
├── builtin/               # Встроенные функции (математические)
├── examples/              # Примеры кода на foo_lang (30+ файлов)
├── lexer/                 # Лексический анализатор
├── modules/               # Система модулей (загрузка, кеширование)  
├── parser/                # Синтаксический анализатор
├── scope/                 # Система областей видимости
├── test/                  # Unit-тесты (17 файлов, 109+ тестов)
├── token/                 # Определения токенов
├── value/                 # Система типов
├── main.go                # Точка входа
└── README.md              # Полная документация
```

## Статус: ✅ ПОЛНОСТЬЮ ГОТОВЫЙ ЯЗЫК ПРОГРАММИРОВАНИЯ

### 🔥 Ключевые возможности (все реализованы и протестированы):

#### 1. Современная система функций
- **Обычные функции**: `fn add(a, b) { return a + b }`
- **Анонимные функции**: `let add = fn(x, y) => x + y` 
- **Функции высшего порядка**: функции, возвращающие функции
- **Замыкания**: автоматический захват переменных из внешней области
- **Параметры по умолчанию**: `fn greet(name, prefix = "Hello") { ... }`
- **Множественные возвращаемые значения**: `return a, b, c`
- **Множественное присваивание**: `let x, y, z = func()`

#### 2. Модульная система с реальной загрузкой файлов
```foo
// math.foo
export fn add(a, b) { return a + b }
export let PI = 3.14159

// main.foo
import { add, PI } from "math.foo"    // Селективный импорт
import * as Math from "math.foo"      // Алиас импорт
import "math.foo"                     // Полный импорт
```
- Кеширование модулей (загружаются только один раз)
- Поддержка всех типов импорта/экспорта
- Изоляция областей видимости между модулями

#### 3. Встроенные математические функции
13 функций с правильной обработкой ошибок:
- **Тригонометрические**: sin, cos, tan
- **Степени/корни**: sqrt, pow
- **Округление**: abs, floor, ceil, round
- **Экстремумы**: min, max
- **Логарифмы**: log, log10, exp

#### 4. Продвинутые типы и конструкции
- **Result тип**: `Ok(value)` и `Err(error)` как в Rust
- **Enum типы**: `enum Color { RED, GREEN, BLUE }`
- **Match выражения**: pattern matching с default case
- **Тернарный оператор**: `condition ? true : false`
- **for-yield**: создание массивов `for ... { yield value }`

#### 5. Богатая система типов
- **Базовые типы**: int64, float64, string, bool
- **Коллекции**: массивы [1,2,3], объекты {key: value}
- **Методы**: array.length(), array.push(), obj.property
- **Индексация**: arr[0], obj["key"], цепочные вызовы
- **Строковая интерполяция**: `"Hello ${name}, you are ${age}"`

#### 6. Полная система операторов
- **Арифметические**: +, -, *, /, %
- **Сравнения**: ==, !=, >, <, >=, <=
- **Логические**: &&, ||, !
- **Составные присваивания**: +=, -=, *=, /=, %=
- **Инкремент/декремент**: ++, --

## 📊 Покрытие тестами: 100%

**17 файлов unit-тестов** с **109+ тестами**:
- `test/basic_types_test.go` - типы и операторы
- `test/functions_test.go` - функции и рекурсия  
- `test/closures_test.go` - замыкания (5 тестов)
- `test/anonymous_functions_test.go` - анонимные функции (5 тестов)
- `test/math_functions_test.go` - математические функции (14 тестов)
- `test/module_loading_test.go` - загрузка модулей (4 теста)
- `test/collections_test.go` - массивы и объекты
- `test/result_test.go` - Result тип
- `test/string_features_test.go` - интерполяция и комментарии
- И другие...

**Все тесты проходят успешно!**

## 🎯 Важные технические детали

### Архитектура интерпретатора
- **Tree-walking interpreter**: AST выполняется напрямую
- **Recursive descent parser**: парсер с precedence climbing
- **Unified type system**: все значения через структуру Value
- **Scope stack**: стек областей видимости для функций и модулей

### Ключевые файлы

#### `ast/` - AST узлы и интерпретатор
- `anonymous_func.go` - анонимные функции
- `closure.go` - замыкания с захватом переменных
- `func_expr.go` - обычные функции
- `for_expr.go` - циклы и for-yield
- `result_expr.go` - Result тип (Ok/Err)
- `import_expr.go/export_expr.go` - модульная система

#### `builtin/math.go` - встроенные математические функции
13 функций с правильной обработкой ошибок и граничных случаев

#### `modules/module.go` - система модулей
- Загрузка и парсинг .foo файлов
- Кеширование модулей
- Изоляция областей видимости

#### `scope/scope.go` - система областей видимости
- Stack-based scoping
- Push/pop для функций
- Глобальная и локальные области

#### `value/value.go` - система типов
- Unified Value структура
- Автоматическое приведение типов
- Специальные флаги (isReturn, isBreak, isYield)

## 🚧 Что НЕ реализовано (будущие возможности):

1. **JSON поддержка** (parse/stringify)
2. **Файловая система** (чтение/запись файлов) 
3. **Регулярные выражения**
4. **Стандартная библиотека** (std пакет)
5. **Многопоточность**
6. **LSP поддержка** (планируется как следующий шаг)
7. **Синтаксис хайлайтинг** (планируется)
8. **Документация сайт** (планируется, возможно с Astro)

## 📈 История развития проекта

### ✅ Последние достижения (Январь 2025):
1. **Анонимные функции** - полная поддержка стрелочного и блочного синтаксиса
2. **Замыкания** - автоматический захват переменных из внешней области
3. **Математические функции** - 13 встроенных функций с обработкой ошибок
4. **Модульная система** - реальная загрузка файлов с кешированием
5. **Множественные возвращаемые значения** - destructuring assignment
6. **Параметры по умолчанию** - для функций с выражениями
7. **Result тип** - полная реализация Ok/Err как в Rust
8. **100% покрытие тестами** - все функции протестированы

### ✅ Ранние достижения:
1. **for-yield конструкции** - создание массивов через циклы
2. **Строковая интерполяция** - `"Hello ${name}"`
3. **Enum типы и Match** - pattern matching
4. **Области видимости** - stack-based scoping с защитой от overflow
5. **Комментарии** - // и /* */ 
6. **Объекты и массивы** - с методами и индексацией
7. **Цепочные вызовы** - obj.method().property
8. **Составные операторы** - +=, -=, ++, --

## 💻 Команды для работы

### Запуск
```bash
# Запуск файла по умолчанию (examples/main.foo)
go run main.go

# Запуск конкретного файла
go run main.go examples/test_anonymous_functions.foo
go run main.go examples/test_math.foo
go run main.go examples/test_closures.foo
```

### Тестирование
```bash
# Запуск всех тестов (109+ тестов)
go test ./test/... -v

# Запуск конкретного теста  
go test ./test/anonymous_functions_test.go -v
go test ./test/math_functions_test.go -v
```

### Сборка
```bash
go build -o foo_lang main.go
./foo_lang examples/main.foo
```

## 🔧 Архитектурные принципы

### AST узлы (ast/)
1. Каждый узел реализует интерфейс `Expr` с методом `Eval()`
2. Один узел = одна операция (принцип единственной ответственности)
3. Минимум полей, максимум читаемости
4. Все специальные состояния через флаги в `Value`

### Парсинг (parser/)
- **Recursive descent parser** с precedence climbing
- Обработка ошибок через panic с восстановлением
- Поддержка всех современных языковых конструкций

### Типизация (value/)
- **Unified Value система** - все значения через одну структуру
- Автоматическое приведение типов для арифметики
- Строгая типизация для логических операций

## ⚡ КРИТИЧЕСКИ ВАЖНО ДЛЯ CLAUDE:

### 🎯 После ЛЮБОЙ реализации новой функции:
1. **ОБЯЗАТЕЛЬНО обновить README.md** - добавить фичу в список реализованных
2. **Добавить "✅ тесты готовы"** если написаны тесты
3. **Обновить список примеров** если созданы demo файлы
4. **Убрать из списка ограничений** если проблема решена

### 📝 Формат обновления README:
```markdown  
- [x] **Название новой фичи** ✅ **тесты готовы**
```

### 🔄 README.md должен ВСЕГДА быть актуальным!

## 🚀 Статус проекта: ГОТОВ К ИСПОЛЬЗОВАНИЮ

Язык **foo_lang v2** является полнофункциональным интерпретируемым языком программирования со всеми современными возможностями. Подходит для:

- 🎓 **Изучения языков программирования**
- 🔬 **Исследования интерпретаторов** 
- 💡 **Прототипирования алгоритмов**
- 📚 **Образовательных целей**
- 🎯 **Демонстрации modern language features**

**Следующие шаги развития**: LSP поддержка, синтаксис хайлайтинг, документация сайт.